{"version":3,"sources":["webpack:///webpack/bootstrap 89066ffcb347bcea2a18","webpack:///./public/extensions/mb-panel/index.js","webpack:///./public/extensions/mb-panel/mb-panel-extension.html","webpack:///./public/extensions/mb-panel/mb-panel.html","webpack:///./public/extensions/mb-panel/mb-panel.directive.js"],"names":["angular","module","directive","api","$rootScope","$timeout","templateUrl","require","replace","link","scope","element","attrs","event","response","alreadyHasData","custom","update","belongsTo","listItem","label","key","value","data","create","enabled","permission","removeAutoSaveData","err","console","log","saveEdits","staging","delete","alreadyHasAutoSaveData","find","fetchAutoSaveData","preStatingData","then","extensionData","currentUser","autoSaveEdits","$onRootScope"],"mappings":"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","file":"extension.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 89066ffcb347bcea2a18\n **/","// inject jade\nimport \"./mb-panel-extension.html\";\nimport \"./mb-panel.html\";\n// end inject jade\n\n// inject js\nimport \"./mb-panel.directive.js\";\n// end inject js\n\n// inject stylus\n// end inject stylus\n\n\n\n/** WEBPACK FOOTER **\n ** ./public/extensions/mb-panel/index.js\n **/","var path = 'extensions/mb-panel/mb-panel-extension.html';\nvar html = \"<mb-panel></mb-panel>\\n\";\nwindow.angular.module('meanbaseApp').run(['$templateCache', function(c) { c.put(path, html) }]);\nmodule.exports = path;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./public/extensions/mb-panel/mb-panel-extension.html\n ** module id = 1\n ** module chunks = 0\n **/","var path = 'extensions/mb-panel/mb-panel.html';\nvar html = \"<div class=\\\"panel panel-default\\\">\\n\\t<div class=\\\"panel-heading\\\">\\n    <div mb-edit ng-model=\\\"data.headingText\\\" bind-options=\\\"editorSingleLine\\\" ng-change=\\\"autoSaveEdits()\\\"></div>\\n\\t</div>\\n\\t<div class=\\\"panel-body\\\">\\n\\t\\t<div mb-edit ng-model=\\\"data.bodyText\\\" bind-options=\\\"editorOptions\\\" ng-change=\\\"autoSaveEdits()\\\"></div>\\n\\t</div>\\n</div>\\n\";\nwindow.angular.module('meanbaseApp').run(['$templateCache', function(c) { c.put(path, html) }]);\nmodule.exports = path;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./public/extensions/mb-panel/mb-panel.html\n ** module id = 2\n ** module chunks = 0\n **/","angular.module('meanbaseApp').directive('mbPanel', (api, $rootScope, $timeout) => ({\n  templateUrl: require('./mb-panel.html'),\n  replace: true,\n  link: async (scope, element, attrs) => {\n\n    scope.data = {}\n    let alreadyHasData = false\n    let alreadyHasAutoSaveData = false\n\n    let preStatingData = api.staging.find({belongsTo: scope.listItem.label, key: scope.listItem.key}).then(function(preStatingData) {\n      preStatingData = preStatingData[0]\n      if(preStatingData) {\n        alreadyHasAutoSaveData = true\n      }\n    });\n\n    try {\n      let extensionData = await api.custom.find({belongsTo: scope.listItem.label, key: scope.listItem.key})\n      extensionData = extensionData[0]\n      if(extensionData) {\n        alreadyHasData = true\n        scope.data = extensionData.value\n      }\n    } catch(err) {\n      console.log(`Error fetching ${scope.listItem.key} data`, err);\n    }\n\n    if(!$rootScope.currentUser) { return false }\n\n    async function saveEdits(event) {\n      try {\n        let response\n        if(alreadyHasData) {\n          response = await api.custom.update({belongsTo: scope.listItem.label, key: scope.listItem.key}, {value: scope.data})\n        } else {\n          alreadyHasData = true\n          response = await api.custom.create({belongsTo: scope.listItem.label, key: scope.listItem.key, value: scope.data, enabled: true, permission: 'editContent'})\n\n        }\n        scope.data = response.value\n\n        removeAutoSaveData()\n\n      } catch(err) {\n        console.log('Error saving extension data ', err);\n      }\n\n    }\n\n    async function removeAutoSaveData() {\n      try {\n        await api.staging.delete({belongsTo: scope.listItem.label, key: scope.listItem.key})\n        alreadyHasAutoSaveData = false\n      } catch(err) {\n        console.log(`Error deleting ${scope.listItem.label} autosave data`, err);\n      }\n    }\n\n    async function fetchAutoSaveData() {\n      try {\n        let data = await api.staging.find({belongsTo: scope.listItem.label, key: scope.listItem.key})\n        data = data[0]\n        if(data) {\n          scope.data = data.data\n          alreadyHasAutoSaveData = true\n        }\n      } catch(err) {\n        console.log(`Error deleting ${scope.listItem.label} autosave data`, err);\n      }\n    }\n\n\n    scope.autoSaveEdits = async function(event) {\n      try {\n        let response\n        if(alreadyHasAutoSaveData) {\n          response = await api.staging.update({belongsTo: scope.listItem.label, key: scope.listItem.key}, {data: scope.data})\n        } else {\n          alreadyHasAutoSaveData = true\n          response = await api.staging.create({belongsTo: scope.listItem.label, key: scope.listItem.key, data: scope.data, enabled: true, permission: 'editContent'})\n        }\n      } catch(err) {\n        console.log('Error saving extension data ', err);\n      }\n\n    }\n\n    // let directiveWatcher = scope.$watch(scope.data, _.debounce(function(newValue, oldValue) {\n    //   if(typeof newValue !== oldValue) {\n    //     console.log(\"newValue\", newValue);\n    //     $rootScope.$emit('cms.autoSave')\n    //     scope.autoSavingInProgress = true\n    //     $timeout(function() {\n    //       scope.autoSavingInProgress = false\n    //     }, 1000);\n    //   }\n    // }, 100), true)\n\n    scope.$onRootScope('cms.publish', saveEdits)\n    scope.$onRootScope('cms.publishChanges', saveEdits)\n    // scope.$onRootScope('cms.autoSave', _.debounce(autoSaveEdits, 100))\n    scope.$onRootScope('cms.resetDraft', removeAutoSaveData)\n    scope.$onRootScope('cms.pullAutoSaveData', fetchAutoSaveData)\n\n  }\n}))\n\n\n\n/** WEBPACK FOOTER **\n ** ./public/extensions/mb-panel/mb-panel.directive.js\n **/"],"sourceRoot":""}