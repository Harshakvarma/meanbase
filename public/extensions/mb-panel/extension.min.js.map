{"version":3,"sources":["webpack:///webpack/bootstrap 008e4bf940508c18a0fc","webpack:///./public/extensions/mb-panel/index.js","webpack:///./public/extensions/mb-panel/mb-panel-extension.html","webpack:///./public/extensions/mb-panel/mb-panel.html","webpack:///./public/extensions/mb-panel/mb-panel.directive.js"],"names":["angular","module","directive","api","templateUrl","require","replace","link","scope","element","attrs","event","response","alreadyHasData","custom","update","belongsTo","listItem","label","key","value","data","create","enabled","permission","removeAutoSaveData","err","console","log","saveEdits","staging","delete","alreadyHasAutoSaveData","find","extensionData","fetchAutoSaveData","autoSaveEdits","$onRootScope"],"mappings":"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","file":"extension.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 008e4bf940508c18a0fc\n **/","// inject jade\nimport \"./mb-panel-extension.html\";\nimport \"./mb-panel.html\";\n// end inject jade\n\n// inject js\nimport \"./mb-panel.directive.js\";\n// end inject js\n\n// inject stylus\n// end inject stylus\n\n\n\n/** WEBPACK FOOTER **\n ** ./public/extensions/mb-panel/index.js\n **/","var path = 'extensions/mb-panel/mb-panel-extension.html';\nvar html = \"<mb-panel></mb-panel>\\n\";\nwindow.angular.module('meanbaseApp').run(['$templateCache', function(c) { c.put(path, html) }]);\nmodule.exports = path;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./public/extensions/mb-panel/mb-panel-extension.html\n ** module id = 1\n ** module chunks = 0\n **/","var path = 'extensions/mb-panel/mb-panel.html';\nvar html = \"<div class=\\\"panel panel-default\\\">\\n\\t<div class=\\\"panel-heading\\\">\\n    <div mb-edit ng-model=\\\"data.headingText\\\" bind-options=\\\"editorSingleLine\\\" ng-change=\\\"autoSave()\\\"></div>\\n\\t</div>\\n\\t<div class=\\\"panel-body\\\">\\n\\t\\t<div mb-edit ng-model=\\\"data.bodyText\\\" bind-options=\\\"editorOptions\\\" ng-change=\\\"autoSave()\\\"></div>\\n\\t</div>\\n</div>\\n\";\nwindow.angular.module('meanbaseApp').run(['$templateCache', function(c) { c.put(path, html) }]);\nmodule.exports = path;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./public/extensions/mb-panel/mb-panel.html\n ** module id = 2\n ** module chunks = 0\n **/","angular.module('meanbaseApp').directive('mbPanel', api => ({\n  templateUrl: require('./mb-panel.html'),\n  replace: true,\n  link: async (scope, element, attrs) => {\n\n    scope.data = {}\n    let alreadyHasData = false\n    let alreadyHasAutoSaveData = false\n    try {\n      let extensionData = await api.custom.find({belongsTo: scope.listItem.label, key: scope.listItem.key})\n      extensionData = extensionData[0]\n      if(extensionData) {\n        alreadyHasData = true\n        scope.data = extensionData.value\n      }\n    } catch(err) {\n      console.log(`Error fetching ${scope.listItem.key} data`, err);\n    }\n\n    async function saveEdits(event) {\n      try {\n        let response\n        if(alreadyHasData) {\n          response = await api.custom.update({belongsTo: scope.listItem.label, key: scope.listItem.key}, {value: scope.data})\n        } else {\n          response = await api.custom.create({belongsTo: scope.listItem.label, key: scope.listItem.key, value: scope.data, enabled: true, permission: 'editContent'})\n          alreadyHasData = true\n        }\n        scope.data = response.value\n\n        removeAutoSaveData()\n\n      } catch(err) {\n        console.log('Error saving extension data ', err);\n      }\n\n    }\n\n    async function removeAutoSaveData() {\n      try {\n        await api.staging.delete({belongsTo: scope.listItem.label, key: scope.listItem.key})\n        alreadyHasAutoSaveData = false\n      } catch(err) {\n        console.log(`Error deleting ${scope.listItem.label} autosave data`, err);\n      }\n    }\n\n    async function fetchAutoSaveData() {\n      try {\n        let data = await api.staging.find({belongsTo: scope.listItem.label, key: scope.listItem.key})\n        data = data[0]\n        if(data) {\n          scope.data = extensionData.data\n          alreadyHasAutoSaveData = true\n        }\n\n      } catch(err) {\n        console.log(`Error deleting ${scope.listItem.label} autosave data`, err);\n      }\n    }\n\n\n    async function autoSaveEdits(event) {\n      try {\n        let response\n        if(alreadyHasAutoSaveData) {\n          response = await api.staging.update({belongsTo: scope.listItem.label, key: scope.listItem.key}, {data: scope.data})\n        } else {\n          response = await api.staging.create({belongsTo: scope.listItem.label, key: scope.listItem.key, data: scope.data, enabled: true, permission: 'editContent'})\n          alreadyHasAutoSaveData = true\n        }\n        scope.data = response.value\n      } catch(err) {\n        console.log('Error saving extension data ', err);\n      }\n\n    }\n\n    scope.$onRootScope('cms.publish', saveEdits)\n    scope.$onRootScope('cms.publishChanges', saveEdits)\n    scope.$onRootScope('cms.autoSave', autoSaveEdits)\n    scope.$onRootScope('cms.resetDraft', removeAutoSaveData)\n    scope.$onRootScope('cms.pullAutoSaveData', fetchAutoSaveData)\n\n  }\n}))\n\n\n\n/** WEBPACK FOOTER **\n ** ./public/extensions/mb-panel/mb-panel.directive.js\n **/"],"sourceRoot":""}